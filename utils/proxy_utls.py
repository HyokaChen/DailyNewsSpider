#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
 @File       : proxy_utls.py
 @Time       : 2017/12/2 0002 19:46
 @Author     : Empty Chan
 @Contact    : chen19941018@gmail.com
 @Description:
 @License    : (C) Copyright 2016-2017, iFuture Corporation Limited.
"""
import json
import requests
import random
from utils.decorator import safely_json_loads
from utils.db_util import rdb
from utils import UserAgent
import random
ua = UserAgent()


def get_random_proxy():
    session = requests.session()
    print('xiazia')
    # proxys = ['117.90.0.178:9000', '58.22.207.37:9000', '106.111.53.152:9999', '117.90.4.3:9000', '111.75.223.9:30646', '120.25.90.253:8118', '122.242.134.193:9000', '139.199.19.174:8118', '121.232.148.23:9000', '1.193.244.92:9999', '171.11.59.110:9999', '114.234.82.107:9000', '114.239.3.34:9999', '115.218.208.16:9000', '175.42.129.62:9999', '117.90.4.87:9000', '139.196.22.147:80', '117.87.176.80:9000', '163.204.243.30:9999', '121.232.199.77:9000', '211.159.171.58:80', '183.129.207.80:12608', '125.115.180.53:3128', '175.44.152.44:9000', '1.193.244.164:9999', '163.204.247.25:9999', '163.125.28.226:8118', '114.234.83.47:9000', '163.204.240.203:9999', '125.110.95.67:9000', '117.90.2.227:9000', '163.204.241.140:9999', '115.151.205.72:9000', '120.76.191.177:8118', '117.95.199.180:9999', '45.125.32.182:3128', '183.129.244.16:12363', '202.109.157.65:9000', '117.90.252.165:9000', '180.118.128.254:9000', '183.129.244.16:11389', '117.90.0.141:9000', '175.44.156.74:9000', '219.146.127.6:8060', '180.118.128.199:9000', '60.190.250.120:8080', '117.90.2.224:9000', '163.125.248.174:8118', '117.90.6.189:9000', '171.13.103.178:9999', '117.90.6.206:9000', '175.44.155.13:9000', '219.159.38.207:56210', '175.44.186.195:9000', '171.13.137.138:9999', '49.70.48.5:9999', '47.93.58.5:8118', '163.204.247.60:9999', '163.204.247.41:9999', '118.181.226.216:58654', '121.232.194.60:9000', '183.147.223.245:9000', '117.90.6.240:9000', '180.118.128.89:9000', '125.110.67.40:9000', '112.111.116.57:9000', '175.44.186.32:9000', '117.87.177.4:9000', '163.204.242.81:9999', '111.77.22.243:9000', '222.223.203.104:8060', '183.129.244.16:11492', '202.109.157.63:9000', '58.22.205.152:9000', '58.253.155.56:9999', '123.132.232.254:61017', '1.198.73.91:9999', '117.90.6.187:9000', '180.118.134.60:9000', '183.129.207.80:12608', '58.22.212.32:9000', '112.111.118.99:9000', '59.32.37.206:3128', '117.90.6.248:9000', '125.108.68.148:9000', '58.22.210.85:9000', '183.161.29.127:8060', '112.111.117.46:9000', '136.228.128.14:61158', '183.129.207.80:12777', '117.90.137.112:9000', '175.161.7.184:9000', '114.235.22.100:9000', '124.42.68.152:90', '163.204.243.250:9999', '163.204.240.207:9999', '114.234.80.145:9000', '175.44.155.12:9000', '218.58.194.162:8060', '163.204.245.47:9999', '125.110.78.204:9000', '117.41.38.18:9000', '115.218.208.45:9000', '117.90.137.159:9000', '120.234.138.99:53779', '60.205.188.24:3128', '47.107.190.212:8118', '175.42.123.6:9999', '125.122.199.13:9000', '219.159.38.209:56210', '180.118.86.21:9000', '114.234.82.179:9000', '61.183.233.6:54896', '115.218.214.240:9000', '222.189.191.151:9999', '175.44.155.233:9000', '59.32.37.205:3128', '49.81.125.131:9000', '115.218.213.59:9000', '175.44.186.84:9000', '125.110.72.41:9000', '118.181.226.216:58654', '183.129.207.80:12806', '49.86.177.173:9999', '219.159.38.200:56210', '163.204.92.100:9999', '47.94.136.5:8118', '175.44.156.226:9000', '61.164.39.69:53281', '118.180.166.195:8060', '112.111.217.141:9999', '183.129.207.80:12608', '183.129.207.80:14131', '112.85.172.140:9999', '123.206.204.51:8118', '124.93.201.59:42672', '175.44.149.145:9000', '58.22.204.30:9000', '175.42.169.153:9000', '47.94.104.204:8118', '121.232.148.109:9000', '183.129.244.16:12591', '163.204.247.249:9999', '175.44.187.47:9000', '183.129.244.16:11723', '223.100.166.3:36945', '121.232.148.91:9000', '219.159.38.201:56210', '112.87.68.88:9999', '114.235.23.113:9000']
    proxy_json = session.get(
        "http://localhost:8000/get",
        headers={
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36'
        }
    )
    print('ok---')
    proxy = proxy_json.text
    result = 'http://{0}'.format(proxy)
    # session.close()
    return result

# async def get_random_proxy():
#     session = aiorequests.session()
#     random_proxy = rdb.spop("proxy_cached")
#     if random_proxy:
#         temp = safely_json_loads(random_proxy)
#         print(temp)
#         return {
#             "http": "{ip}:{port}".format(ip=temp.get("ip"), port=temp.get("port")),
#             "https": "{ip}:{port}".format(ip=temp.get("ip"), port=temp.get("port")),
#         }
#     proxy_json = await session.get(
#         "http://www.xdaili.cn/ipagent//freeip/getFreeIps?page=1&rows=10",
#         headers={"Referer": "http://www.xdaili.cn/freeproxy", "User-Agent": ua.random},
#     )
#     rows = proxy_json.json()
#     rows = rows.get("RESULT").get("rows")
#     for row in rows:
#         rdb.sadd("proxy_cached", json.dumps(row, ensure_ascii=False))
#     num = random.randint(0, len(rows) - 1)
#     # print(rows[num])
#     proxy = {
#         "http": "{ip}:{port}".format(
#             ip=rows[num].get("ip"), port=rows[num].get("port")
#         ),
#         "https": "{ip}:{port}".format(
#             ip=rows[num].get("ip"), port=rows[num].get("port")
#         ),
#     }
#     session.close()
#     return proxy


if __name__ == "__main__":
    proxy = get_random_proxy()
    print(proxy)
